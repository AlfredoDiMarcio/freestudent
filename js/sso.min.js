"use strict";var getSSOCurrentScript=function(){if(document.currentScript)return document.currentScript.src;var e=document.getElementsByTagName("script");return e[e.length-1].src};window.SSOURL=getSSOCurrentScript().match(/(.*)\/js\//)[1];(function(e,n){if(typeof exports==="object"){module.exports=exports=n()}else if(typeof define==="function"&&define.amd){define([],n)}else{e.SSO=n()}})(this,function(){var ce=ce||function(f,e){var t=Object.create||function(){function t(){}return function(e){var n;return t.prototype=e,n=new t,t.prototype=null,n}}(),n={},r=n.lib={},i=r.Base={extend:function(e){var n=t(this);return e&&n.mixIn(e),n.hasOwnProperty("init")&&this.init!==n.init||(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var n in e)e.hasOwnProperty(n)&&(this[n]=e[n]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},l=r.WordArray=i.extend({init:function(e,n){e=this.words=e||[],this.sigBytes=null!=n?n:4*e.length},toString:function(e){return(e||a).stringify(this)},concat:function(e){var n=this.words,t=e.words,r=this.sigBytes,i=e.sigBytes;if(this.clamp(),r%4)for(var o=0;o<i;o++){var a=t[o>>>2]>>>24-o%4*8&255;n[r+o>>>2]|=a<<24-(r+o)%4*8}else for(o=0;o<i;o+=4)n[r+o>>>2]=t[o>>>2];return this.sigBytes+=i,this},clamp:function(){var e=this.words,n=this.sigBytes;e[n>>>2]&=4294967295<<32-n%4*8,e.length=f.ceil(n/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var n,t=[],r=function(n){n=n;var t=987654321,r=4294967295;return function(){var e=((t=36969*(65535&t)+(t>>16)&r)<<16)+(n=18e3*(65535&n)+(n>>16)&r)&r;return e/=4294967296,(e+=.5)*(f.random()>.5?1:-1)}},i=0;i<e;i+=4){var o=r(4294967296*(n||f.random()));n=987654071*o(),t.push(4294967296*o()|0)}return new l.init(t,e)}}),o=n.enc={},a=o.Hex={stringify:function(e){for(var n=e.words,t=e.sigBytes,r=[],i=0;i<t;i++){var o=n[i>>>2]>>>24-i%4*8&255;r.push((o>>>4).toString(16)),r.push((15&o).toString(16))}return r.join("")},parse:function(e){for(var n=e.length,t=[],r=0;r<n;r+=2)t[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new l.init(t,n/2)}},s=o.Latin1={stringify:function(e){for(var n=e.words,t=e.sigBytes,r=[],i=0;i<t;i++){var o=n[i>>>2]>>>24-i%4*8&255;r.push(String.fromCharCode(o))}return r.join("")},parse:function(e){for(var n=e.length,t=[],r=0;r<n;r++)t[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new l.init(t,n)}},c=o.Utf8={stringify:function(e){try{return decodeURIComponent(escape(s.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return s.parse(unescape(encodeURIComponent(e)))}},u=r.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new l.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=c.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var n=this._data,t=n.words,r=n.sigBytes,i=this.blockSize,o=r/(4*i),a=(o=e?f.ceil(o):f.max((0|o)-this._minBufferSize,0))*i,s=f.min(4*a,r);if(a){for(var c=0;c<a;c+=i)this._doProcessBlock(t,c);var u=t.splice(0,a);n.sigBytes-=s}return new l.init(u,s)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),d=(r.Hasher=u.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,n){return new t.init(n).finalize(e)}},_createHmacHelper:function(t){return function(e,n){return new d.HMAC.init(t,n).finalize(e)}}}),n.algo={});return n}(Math);!function(){var e=ce;e.lib.WordArray,e.enc.Base64={stringify:function(e){var n=e.words,t=e.sigBytes,r=this._map;e.clamp();for(var i=[],o=0;o<t;o+=3)for(var a=(n[o>>>2]>>>24-o%4*8&255)<<16|(n[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|n[o+2>>>2]>>>24-(o+2)%4*8&255,s=0;s<4&&o+.75*s<t;s++)i.push(r.charAt(a>>>6*(3-s)&63));var c=r.charAt(64);if(c)for(;i.length%4;)i.push(c);return i.join("")},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(f){var e=ce,n=e.lib,t=n.WordArray,r=n.Hasher,i=e.algo,I=[];!function(){for(var e=0;e<64;e++)I[e]=4294967296*f.abs(f.sin(e+1))|0}();var o=i.MD5=r.extend({_doReset:function(){this._hash=new t.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,n){for(var t=0;t<16;t++){var r=n+t,i=e[r];e[r]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var o=this._hash.words,a=e[n+0],s=e[n+1],c=e[n+2],u=e[n+3],f=e[n+4],l=e[n+5],d=e[n+6],h=e[n+7],p=e[n+8],g=e[n+9],v=e[n+10],m=e[n+11],S=e[n+12],w=e[n+13],b=e[n+14],k=e[n+15],y=o[0],O=o[1],C=o[2],E=o[3];y=U(y,O,C,E,a,7,I[0]),E=U(E,y,O,C,s,12,I[1]),C=U(C,E,y,O,c,17,I[2]),O=U(O,C,E,y,u,22,I[3]),y=U(y,O,C,E,f,7,I[4]),E=U(E,y,O,C,l,12,I[5]),C=U(C,E,y,O,d,17,I[6]),O=U(O,C,E,y,h,22,I[7]),y=U(y,O,C,E,p,7,I[8]),E=U(E,y,O,C,g,12,I[9]),C=U(C,E,y,O,v,17,I[10]),O=U(O,C,E,y,m,22,I[11]),y=U(y,O,C,E,S,7,I[12]),E=U(E,y,O,C,w,12,I[13]),C=U(C,E,y,O,b,17,I[14]),y=T(y,O=U(O,C,E,y,k,22,I[15]),C,E,s,5,I[16]),E=T(E,y,O,C,d,9,I[17]),C=T(C,E,y,O,m,14,I[18]),O=T(O,C,E,y,a,20,I[19]),y=T(y,O,C,E,l,5,I[20]),E=T(E,y,O,C,v,9,I[21]),C=T(C,E,y,O,k,14,I[22]),O=T(O,C,E,y,f,20,I[23]),y=T(y,O,C,E,g,5,I[24]),E=T(E,y,O,C,b,9,I[25]),C=T(C,E,y,O,u,14,I[26]),O=T(O,C,E,y,p,20,I[27]),y=T(y,O,C,E,w,5,I[28]),E=T(E,y,O,C,c,9,I[29]),C=T(C,E,y,O,h,14,I[30]),y=L(y,O=T(O,C,E,y,S,20,I[31]),C,E,l,4,I[32]),E=L(E,y,O,C,p,11,I[33]),C=L(C,E,y,O,m,16,I[34]),O=L(O,C,E,y,b,23,I[35]),y=L(y,O,C,E,s,4,I[36]),E=L(E,y,O,C,f,11,I[37]),C=L(C,E,y,O,h,16,I[38]),O=L(O,C,E,y,v,23,I[39]),y=L(y,O,C,E,w,4,I[40]),E=L(E,y,O,C,a,11,I[41]),C=L(C,E,y,O,u,16,I[42]),O=L(O,C,E,y,d,23,I[43]),y=L(y,O,C,E,g,4,I[44]),E=L(E,y,O,C,S,11,I[45]),C=L(C,E,y,O,k,16,I[46]),y=A(y,O=L(O,C,E,y,c,23,I[47]),C,E,a,6,I[48]),E=A(E,y,O,C,h,10,I[49]),C=A(C,E,y,O,b,15,I[50]),O=A(O,C,E,y,l,21,I[51]),y=A(y,O,C,E,S,6,I[52]),E=A(E,y,O,C,u,10,I[53]),C=A(C,E,y,O,v,15,I[54]),O=A(O,C,E,y,s,21,I[55]),y=A(y,O,C,E,p,6,I[56]),E=A(E,y,O,C,k,10,I[57]),C=A(C,E,y,O,d,15,I[58]),O=A(O,C,E,y,w,21,I[59]),y=A(y,O,C,E,f,6,I[60]),E=A(E,y,O,C,m,10,I[61]),C=A(C,E,y,O,c,15,I[62]),O=A(O,C,E,y,g,21,I[63]),o[0]=o[0]+y|0,o[1]=o[1]+O|0,o[2]=o[2]+C|0,o[3]=o[3]+E|0},_doFinalize:function(){var e=this._data,n=e.words,t=8*this._nDataBytes,r=8*e.sigBytes;n[r>>>5]|=128<<24-r%32;var i=f.floor(t/4294967296),o=t;n[15+(r+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),n[14+(r+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),e.sigBytes=4*(n.length+1),this._process();for(var a=this._hash,s=a.words,c=0;c<4;c++){var u=s[c];s[c]=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8)}return a},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}});function U(e,n,t,r,i,o,a){var s=e+(n&t|~n&r)+i+a;return(s<<o|s>>>32-o)+n}function T(e,n,t,r,i,o,a){var s=e+(n&r|t&~r)+i+a;return(s<<o|s>>>32-o)+n}function L(e,n,t,r,i,o,a){var s=e+(n^t^r)+i+a;return(s<<o|s>>>32-o)+n}function A(e,n,t,r,i,o,a){var s=e+(t^(n|~r))+i+a;return(s<<o|s>>>32-o)+n}e.MD5=r._createHelper(o)}(Math);var ue={},c=function(){var n=!1;return function(e){return function(){n||(n=!0,e.apply(null,arguments))}}},u=function(e){var n=e&&e.then;if("object"==typeof e&&"function"==typeof n)return function(){return n.apply(e,arguments)}},f=function(t,r){var i=ue.defer(),o=function(n,t){setTimeout(function(){var e;try{e=n(t)}catch(e){return void i.reject(e)}e===i.promise?i.reject(new TypeError("Cannot resolve promise with itself")):i.resolve(e)},1)};return{promise:i.promise,handle:function(e,n){e===d?function(e){t&&t.call?o(t,e):i.resolve(e)}(n):function(e){r&&r.call?o(r,e):i.reject(e)}(n)}}},l=0,d=1,h=2;ue.defer=function(){var r,i=l,o=[],t=function(e,n){i=e,r=n,o.forEach(function(e){e.handle(i,r)}),o=null},a=function(e){t(h,e)},n=function(e,n){var t=f(e,n);return i===l?o.push(t):t.handle(i,r),t.promise},s=function(e){var n;try{n=u(e)}catch(e){return void a(e)}n?function(e){var n=c();try{e(n(s),n(a))}catch(e){n(a)(e)}}(n):function(e){t(d,e)}(e)},e=c();return{resolve:e(s),reject:e(a),promise:{then:n,fail:function(e){return n(null,e)}}}};function fe(e){return e?(e^Math.random()*16>>e/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,fe)}var le=function(e){var n=new ue.defer;var t=document.createElement("script");t.src=e;t.async=true;t.onload=function(){n.resolve()};var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(t,r);return n.promise};var de="https://www.gstatic.com/firebasejs/7.5.0/firebase-app.js",he="https://www.gstatic.com/firebasejs/7.5.0/firebase-auth.js";var pe=window.SSOURL+"/config.js";var ge=ge||function(){var o="cross-domain-local-message";var i=fe();window[i]=false;var a="";var s={isBackendSessionExist:false,isBackendSessionEnabled:false,initCallback:function(){},loginActionCallback:function(){},logoutActionCallback:function(){},loginErrorCallback:function(){},signupActionCallback:function(){},signupErrorCallback:function(){},logoutErrorCallback:function(){},noUserActionCallback:function(){},changePasswordErrorCallback:function(){},changePasswordSuccessCallback:function(){},updateEmailSuccessCallback:function(){},updateEmailErrorCallback:function(){alert("error")},localStorageDisabledCallback:function(){alert("The LocalStorage compatibility library was not found.")},loggingInActionCallback:function(){},loggedInCallback:function(){},createSSOLoginErrorCallback:function(){},serverSetSessionUrl:undefined,serverSetSessionUrlSecondary:undefined,serverPostSignUpUrl:undefined,debug:false,loginWithCredentialsFlag:false};var c=-1,u,f={},n=false,r=true,t=false,l,d,h,p,g=false,v={},m=false,S=false,e=false;function w(e,n){var t=n||{};var r;for(r in e){if(e.hasOwnProperty(r)){t[r]=e[r]}}return t}function b(e){if(f[e.id]){f[e.id](e);delete f[e.id]}}function k(e){I(e);var n;try{n=JSON.parse(e.data)}catch(e){}if(n&&n.namespace===o){if(n.id==="iframe-ready"){r=true;s.initCallback();T()}else if(n.id==="cookie-is-ready"){if(n.qsssoperm==""||!n.qsssoperm){g=true}}else if(n.id==="storage-changed"){if(!m&&window[i]==false){window.location.reload(true)}else{b(n)}}else if(n.id==="linkedin-token"){if(!U(n.QSlinkedinToken)&&!m){var t=JSON.parse(n.QSlinkedinToken);if(t.type!="undefined"&&t.type=="complete"){m=true;ge.loginByToken(t.token);ve.delete("QSlinkedinToken",function(e){I("No more update")})}}}else{b(n)}}}function y(e,n,t,r){c++;f[c]=r;var i={namespace:o,id:c,action:e,key:n,value:t};u.contentWindow.postMessage(JSON.stringify(i),"*")}function O(){var a={apiKey:SSOCONFIG.apiKey,authDomain:SSOCONFIG.authDomain,projectId:SSOCONFIG.projectId};le(de).then(function(){le(he).then(function(){if(!firebase.apps.length){firebase.initializeApp(a)}H();var e=C("code");var n=C("state");var t=C("error");if(t){document.body.innerText="Error back from the LinkedIn auth page: "+t}else if(!e){var r=document.referrer;window.location.href=window.SSOURL+"/linkedin-auth?referrer="+r}else{var i=document.createElement("script");i.type="text/javascript";var o=window.SSOURL+"/linkedin-get-token";i.src=o+"?code="+encodeURIComponent(e)+"&state="+encodeURIComponent(n)+"&callback=SSO.tokenReceived";document.head.appendChild(i)}})})}function C(e){return decodeURIComponent((new RegExp("[?|&]"+e+"="+"([^&;]+?)(&|#|;|$)").exec(location.search)||[null,""])[1].replace(/\+/g,"%20"))||null}function E(t){le(pe).then(function(){var e={iframeId:"cross-domain-iframe",iframeUrl:window.SSOURL+"/sso.html"};s=w(s,e);s=w(s,SSOCONFIG);s=w(t,s);var n=document.createElement("div");if(window.addEventListener){window.addEventListener("message",k,false)}else{window.attachEvent("onmessage",k)}n.innerHTML="<iframe id='"+s.iframeId+"' src="+s.iframeUrl+" style='display: none;'></iframe>";document.body.appendChild(n);u=document.getElementById(s.iframeId);p="firebase:authUser:"+s.apiKey+":[DEFAULT]"})}function I(e){if(s.debug){console.log(e)}}function U(e){var n=Object.prototype.toString;var t=Object.prototype.hasOwnProperty;if(e==null)return true;if("boolean"==typeof e)return false;if("number"==typeof e)return e===0;if("string"==typeof e)return e.length===0;if("function"==typeof e)return e.length===0;if(Array.isArray(e))return e.length===0;if(e instanceof Error)return e.message==="";if(e.toString==n){switch(e.toString()){case"[object File]":case"[object Map]":case"[object Set]":{return e.size===0}case"[object Object]":{for(var r in e){if(t.call(e,r))return false}return true}}}return false}function T(){var e={apiKey:s.apiKey,authDomain:s.authDomain,projectId:s.projectId};le(de).then(function(){le(he).then(function(){if(!firebase.apps.length){firebase.initializeApp(e)}firebase.auth().getRedirectResult().then(function(e){}).catch(function(e){if(e.code=="auth/web-storage-unsupported"){s.loginErrorCallback(e.code,e.message)}});firebase.auth().onAuthStateChanged(function(n){I(n);if(n){t=J();I("options.isBackendSessionEnabled"+s.isBackendSessionEnabled);I("isLoggedIn"+t);I("reached here");if(s.isBackendSessionEnabled===true&&s.isBackendSessionExist===false||s.isBackendSessionEnabled===false&&t==0){I("Getting loggedin from onAuthStateChanged");j(1);Q(function(e){if(e!=false){s.loggingInActionCallback();window[i]=true;A(e,B)}else{}})}else{I("already loggedin");ve.get("QSSESSION",function(e){I(e);if(!e.value&&!g){firebase.auth().signOut().then(function(){j(0);s.logoutActionCallback()}).catch(function(e){s.logoutErrorCallback(e.code,e.message)})}else{firebase.auth().currentUser.getIdToken(true).then(function(e){I("session valid");s.loggedInCallback(L(n))}).catch(function(e){I(e);oe()})}})}}else{t=J();if(H()){I("isloggedin"+t);ve.get("QSSESSION",function(e){I("no value"+e.value);if(!e.value){I("no user");s.noUserActionCallback()}else{var n=JSON.parse(e.value);if(l.getItem(p)===null){I("setting indexed db");G(n,function(){})}}})}else{I("no user");s.noUserActionCallback()}}})})})}function L(e){var n={};n.uid=e.uid;n.email="";if(!U(e.providerData[0])&&!U(e.providerData[0].email)){n.email=e.providerData[0].email}else if(!U(e.email)){n.email=e.email}n.authMethod="linkedin.com";if(!U(e.providerData[0])&&!U(e.providerData[0].providerId)){n.authMethod=e.providerData[0].providerId}return n}function A(e,n){ve.set("QSSESSION",e,function(e){if(e.success){I("Your data has been successfully stored.")}else{I("Ops, could not store your data.")}n()})}function B(){firebase.auth().currentUser.getIdToken(true).then(function(o){I("TOKEN:"+o);m=false;var t=1;if(a!=i){t=1e3}N(t).then(function(){var e=window.SSOURL+"/api/members/createSSOUser";var n={idToken:o,accessToken:h,isMain:1};if(t>1){n.isMain=0}ee(e,n,function(e){var n=JSON.parse(e);I(n);if(n.success==true){if($(s.serverSetSessionUrl)){D(o,h)}else{var t={idToken:o,socialAccessToken:h};if(!U(n.member)){t.member=n.member}s.loginActionCallback(t)}}else{var r="auth/internal-error-occured";var i="Couldnt login";if(typeof n.code!="undefined"){r=n.code;i=n.message}ae();s.loginErrorCallback(r,i)}})})}).catch(function(e){I(e);ae()})}function N(e){var n=new ue.defer;setTimeout(function(){n.resolve(true)},e);return n.promise}function D(e,n){var t=R(e,n);var r=_(e,n);t.then(function(n){r.then(function(e){s.loginActionCallback(n)},function(e){s.loginErrorCallback("auth/internal-invalid","Session couldn't set")})},function(e){s.loginErrorCallback("auth/internal-invalid","Session couldn't set")})}function R(e,n){var t=new ue.defer;var r={idToken:e,socialAccessToken:n,postData:v};ee(s.serverSetSessionUrl,r,function(e){if(V(e)){var n=JSON.parse(e);I("Primary");I(JSON.parse(e));if(n.success==true){t.resolve(n)}else{t.reject("auth/internal-invalid")}}else{t.reject("auth/internal-invalid")}});return t.promise}function _(e,n){var t=new ue.defer;var r={idToken:e,socialAccessToken:h,postData:v};if($(s.serverSetSessionUrlSecondary)){ee(s.serverSetSessionUrlSecondary,r,function(e){I("Secondary");t.resolve(e)})}else{I("SecondaryNo");t.resolve({})}return t.promise}function x(e,n){if($(s.serverPostSignUpUrl)){var t=s.serverPostSignUpUrl;var r={idToken:n,memberId:e,postData:v};ee(t,r,function(e){var n=JSON.parse(e);I(n);if(n.success==true){s.signupActionCallback(n)}else{s.signupErrorCallback("auth/internal-error-occured","Couldnt signup")}})}else{I("Signup submit callback missing")}}function j(e){if(H()){l.setItem("QSisLoggedin",e)}else{z("QSisLoggedin",e,7)}}function J(){var e;if(H()){e=l.getItem("QSisLoggedin")}else{e=W("QSisLoggedin")}if(U(e)){e=0}return e}function P(){if(!n){I("You must call SSO.init() before using it.");return false}if(!r){I("You must wait for iframe ready message before using the api.");return false}return true}function M(){return document.readyState==="complete"}function H(){if(e){return true}try{l=window.localStorage;l.setItem("__test","data");e=true}catch(e){K();return false}l.removeItem("__test");return true}function z(e,n,t){var r="";if(t){var i=new Date;i.setTime(i.getTime()+t*24*60*60*1e3);r="; expires="+i.toUTCString()}document.cookie=e+"="+(n||"")+r+"; path=/"}function W(e){I("y taking value from cookie"+e);var n=e+"=";var t=document.cookie.split(";");for(var r=0;r<t.length;r++){var i=t[r];while(i.charAt(0)==" ")i=i.substring(1,i.length);if(i.indexOf(n)==0)return i.substring(n.length,i.length)}return null}function F(e){document.cookie=e+"=; Max-Age=-99999999;"}function Q(i){var e=Y();if(e){var o=e.open("firebaseLocalStorageDb",1);o.onsuccess=function(){var e=o.result;var n=e.transaction("firebaseLocalStorage","readwrite");var t=n.objectStore("firebaseLocalStorage");var r=t.get(p);r.onsuccess=function(e){I(e);I(r.result.value);var n=r.result.value;I(n);i(n)};r.onerror=function(e){I("indexeddb errro"+request.errorCode);var n=false;i(n)};n.oncomplete=function(){I("trans completed");e.close()}};o.onerror=function(e){I(e);i(q())}}else{I("No indexed db");i(q())}}function G(i,o){var e=Y();if(e){var a=e.open("firebaseLocalStorageDb",1);a.onsuccess=function(){var e=a.result;var n=e.transaction("firebaseLocalStorage","readwrite");var t=n.objectStore("firebaseLocalStorage");var r=t.put({fbase_key:p,value:i});r.onerror=function(e){I("Error",e.target.error.name)};r.onsuccess=function(e){I("Woot! Did it");o()};n.oncomplete=function(){e.close()}};a.onerror=function(e){I(e);X(i);o()}}else{X(i);o()}}function q(){if(H()){var e=l.getItem(p);if(V(e)){return JSON.parse(e)}}return false}function X(e){if(H()){e=JSON.stringify(e);l.setItem(p,e)}}function K(){I("LOCAL STORAGE NOT ENABLED");s.localStorageDisabledCallback()}function Y(){var e=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB||window.shimIndexedDB;if(e){return e}else{return false}}function Z(){I("SAFARI FIX"+g);if(g){var e=window.open(window.SSOURL+"/authorise.html")}}function $(e){if(e!=""&&e!=undefined&&e!=false&&typeof e!="undefined"){var n=e.match(/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/g);if(n==null&&e.indexOf("://localhost")==-1)return false;else return true}else{return false}}function V(e){try{JSON.parse(e)}catch(e){return false}return true}function ee(e,n,t){var r=typeof n=="string"?n:Object.keys(n).map(function(e){if(e!=="postData"){return encodeURIComponent(e)+"="+encodeURIComponent(n[e])}else{return""}}).join("&");I(n);if(typeof n.postData!="undefined"){var i=n.postData;var o="";if(JSON.stringify(i)!=="{}"){o=typeof i=="string"?i:Object.keys(i).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(i[e])}).join("&")}if(o!=""){r+="&"+o}}var a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");a.open("POST",e);a.onreadystatechange=function(){if(a.readyState>3&&a.status==200){t(a.responseText)}};a.setRequestHeader("X-Requested-With","XMLHttpRequest");a.setRequestHeader("Content-Type","application/x-www-form-urlencoded");if(s.loginWithCredentialsFlag){a.withCredentials=true}a.send(r);return a}function ne(e,t){if(window.location==undefined||window.location.host==undefined||window.location!=undefined&&window.location.host!=undefined&&window.location.host.indexOf("qsleap")!=-1){var n=window.SSOURL+"/api/members/getMemberSource";var r={email:e};ee(n,r,function(e){var n=JSON.parse(e);I(JSON.parse(e));if(n.success==true){t(n.source)}else{t(null)}})}else{t(null)}}function te(e){return"{MD5}"+ce.MD5(e).toString(ce.enc.Base64)}function re(e,n){}function ie(e,n,t,r){var i=window.screenLeft!=undefined?window.screenLeft:window.screenX;var o=window.screenTop!=undefined?window.screenTop:window.screenY;var a=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width;var s=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height;var c=a/2-t/2+i;var u=s/2-r/2+o;var f=window.open(e,n,"scrollbars=yes, width="+t+", height="+r+", top="+u+", left="+c);if(window.focus){try{f.focus()}catch(e){}}}function oe(){window[i]=true;firebase.auth().signOut().then(function(){j(0);ve.delete("QSSESSION",function(e){I(e);s.logoutActionCallback()})}).catch(function(e){s.logoutErrorCallback(e.code,e.message)})}function ae(){window[i]=true;firebase.auth().signOut().then(function(){j(0);ve.delete("QSSESSION",function(e){})}).catch(function(e){})}function se(){if(firebase.auth().currentUser.emailVerified==false){return true}else{return false}}return{getOptions:function(){return s},setOption:function(e,n){s[e]=n},init:function(e){if(n){I("SSO was already initialized!");return}n=true;if(M()){E(e)}else{if(document.addEventListener){document.addEventListener("readystatechange",function(){if(M()){E(e)}})}else{document.attachEvent("readystatechange",function(){if(M()){E(e)}})}}},lnInit:function(){if(n){I("SSO was already initialized!");return}n=true;if(M()){O()}else{if(document.addEventListener){document.addEventListener("readystatechange",function(){if(M()){O()}})}else{document.attachEvent("readystatechange",function(){if(M()){O()}})}}},setItem:function(e,n,t){if(!P()){return}y("set",e,n,t)},getItem:function(e,n){if(!P()){return}y("get",e,null,n)},removeItem:function(e,n){if(!P()){return}y("remove",e,null,n)},clear:function(e){if(!P()){return}y("clear",null,null,e)},wasInit:function(){return n},login:function(t,r,e){Z();var n=false;if(e!=undefined&&e!=""){ge.socialLogin(e)}else{if(t!=""&&r!=""){ne(t,function(e){var n="";if(e!==null){n=e}d="password";h="";if(n=="QsLeapImport"){r=re(r)}else{r=te(r)}a=i;firebase.auth().signInWithEmailAndPassword(t,r).then(function(e){if(S){S=false;s.changePasswordSuccessCallback()}I("Getting loggedin from login method")}).catch(function(e){s.loginErrorCallback(e.code,e.message)})})}}},socialLogin:function(e){var n=false;if(!U(e)){if(e=="facebook"){Z();n=new firebase.auth.FacebookAuthProvider;n.addScope("email")}else if(e=="google"){Z();n=new firebase.auth.GoogleAuthProvider;n.addScope("profile");n.addScope("email")}else if(e=="linkedin"){d=e;ie(window.SSOURL+"/auth-popup.html","linkedin Auth",400,585)}if(n!=false){d=e;a=i;firebase.auth().signInWithPopup(n).then(function(e){var n=e.credential.accessToken;h=n;I(h);var t=e.user;I(t);I("Getting loggedin from login method")}).catch(function(e){if(e.code=="auth/popup-blocked"){firebase.auth().signInWithRedirect(n).then(function(e){var n=e.credential.accessToken;h=n;I(h);var t=e.user;I(t);I("Getting loggedin from login method")}).catch(function(e){s.loginErrorCallback(e.code,e.message)})}else{s.loginErrorCallback(e.code,e.message)}})}}},logout:function(){oe()},signup:function(t){Z();v=t;var e=window.SSOURL+"/api/members/createMember";ee(e,t,function(e){var n=JSON.parse(e);I(JSON.parse(e));if(n.success==true){if(n.doLogin==true){ge.login(t.email,t.password)}else{x(n.memberId,n.verifyToken)}}else{s.signupErrorCallback(n.code,n.message)}})},tokenReceived:function(e){I("token recieved");if(e.success!="undefined"&&e.success&&e.token){var n={type:"complete",token:e.token};l.setItem("QSlinkedinToken",JSON.stringify(n));window.close()}else{I(e);document.body.innerText="Error in the token Function: "+e.error}},loginByToken:function(e){firebase.auth().signInWithCustomToken(e).then(function(){I("Getting loggedin from loginByToken method")}).catch(function(e){s.loginErrorCallback(e.code,e.message)})},changePassword:function(t,i){var r=window.SSOURL+"/api/members/updatePassword";var o=firebase.auth().currentUser;I(o);if(o){if(typeof o.providerData[0]!=="undefined"&&o.providerData[0].providerId=="password"){firebase.auth().currentUser.getIdToken(true).then(function(e){I("TOKEN:"+e);var n="oldPassword="+t+"&password="+i+"&idToken="+e;ee(r,n,function(e){var n=JSON.parse(e);I(JSON.parse(e));if(n.success==true){var t=o.providerData[0].email;S=true;ge.login(t,i)}else{var r="auth/password-not-changed";if(typeof n.code!="undefined"){r=n.code}s.changePasswordErrorCallback(r)}})}).catch(function(e){I(e);oe()})}else{s.changePasswordErrorCallback("auth/social-account")}}},updateEmail:function(r){firebase.auth().currentUser.reload().then(function(e){I(firebase.auth().currentUser)});if(se()){firebase.auth().currentUser.getIdToken(true).then(function(e){var n=window.SSOURL+"/get-custom-token";var t={idToken:e,email:r};ee(n,t,function(e){var n=JSON.parse(e);I(JSON.parse(e));if(n.success==true){firebase.auth().signInWithCustomToken(n.idToken).then(function(e){firebase.auth().currentUser.updateEmail(r).then(function(e){firebase.auth().currentUser.reload().then(function(e){firebase.auth().currentUser.getIdToken(true).then(function(e){var n=window.SSOURL+"/api/members/updateEmail";var t="email="+r+"&idToken="+e;ee(n,t,function(e){var n=JSON.parse(e);I(JSON.parse(e));if(n.success==true){firebase.auth().currentUser.reload().then(function(e){I(firebase.auth().currentUser);A(firebase.auth().currentUser,function(){s.updateEmailSuccessCallback(r)})})}else{var t="auth/email-not-changed";if(typeof n.code!="undefined"){t=n.code}s.updateEmailErrorCallback(t)}})})})}).catch(function(e){s.updateEmailErrorCallback(e.code)})}).catch(function(e){I(e)})}else{var t="auth/email-not-changed";if(typeof n.code!="undefined"){t=n.code}s.updateEmailErrorCallback(t)}})})}else{var e="auth/email-already-verified";s.updateEmailErrorCallback(e)}},isUpdateEmailEnabled:function(){return se()},createSSOLogin:function(e,t,r){Z();var n=window.SSOURL+"/api/members/createSSOLogin";var i="memberId="+e;ee(n,i,function(e){var n=JSON.parse(e);I(JSON.parse(e));if(n.success==true){ge.login(t,r)}else{s.createSSOLoginErrorCallback(n.code,n.message)}})}}}();var ve={set:function(e,n,t){if(e){n=JSON.stringify(n,null,2);ge.setItem(e,n,function(e){t(e)})}},get:function(e,n){if(e){ge.getItem(e,function(e){n(e)})}},delete:function(e,n){if(e){ge.removeItem(e,function(e){n(e)})}},clear:function(n){if(key){ge.clear(function(e){n(e)})}}};return ge});
